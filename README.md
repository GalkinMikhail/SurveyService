# Сервис для опроса пользователей.
Функционал для администратора системы:

- авторизация в системе (регистрация не нужна)
- добавление/изменение/удаление опросов. Атрибуты опроса: название, дата старта, дата окончания, описание. После создания поле "дата старта" у опроса менять нельзя
- добавление/изменение/удаление вопросов в опросе. Атрибуты вопросов: текст вопроса, тип вопроса (ответ текстом(TEXT), ответ с выбором одного варианта(SINGLE_SELECT), ответ с выбором нескольких вариантов(MULTI_SELECT))

Функционал для пользователей системы:

- получение списка активных опросов
- прохождение опроса: опросы можно проходить анонимно, в качестве идентификатора пользователя в API передаётся числовой ID, по которому сохраняются ответы пользователя на вопросы; один пользователь может участвовать в любом количестве опросов
- получение пройденных пользователем опросов с детализацией по ответам (что выбрано) по ID уникальному пользователя

# Используемые технологии
Spring Boot(Data,Web,Security) 2.6.3  
MySQL 8.0.28  
Liquibase  
Maven  

# Инструкция по развертыванию приложения  
1. Создать пустую базу данных MySQL.  
2. Запустить прилагаемый Jar файл с помощью команды java -DDB_NAME=имя_бд -DDB_USER=пользователь_бд -DDB_PASSWORD=пароль_бд -jar fabriqueTestTask-0.0.1-SNAPSHOT.jar  
Пример: java -DDB_NAME=surveyService -DDB_USER=root -DDB_PASSWORD=root -jar fabriqueTestTask-0.0.1-SNAPSHOT.jar  

# Документация по API  
Хост: http://localhost:8080  
Сервис для передачи запросов: https://web.postman.co/
## Авторизация в системе  
`POST /auth/login`  
**Запрос:**  
Администратор:
```json
{
  "username": "admin",
  "password": "admin"
}
```  
Пользователь:  
```json
{
  "username": "user",
  "password": "user"
}
```  
**Ответ:**  
```json  
{
    "Unique id": 1,
    "login": "admin",
    "token": "token"
}
```  
В ответе пользователь получает свой уникальный ID и токен авторизации.  
Токен нужно передать в формате "Bearer_token" в Headers -> Authorization.

![Снимок экрана 2022-02-24 в 17 56 30](https://user-images.githubusercontent.com/78902538/155548844-f6a18bca-55ed-4332-b685-f287660559c1.jpg)

## Работа с опросами  
### Создание опроса (Администратор) - `POST /api/survey`
**Запрос:**  
```json
{
  "title":"Опрос",
  "expirationDate":"2022-02-25T15:00:00",
  "description":"Описание запроса"
}
```  
### Получить информацию об опросе - `GET /api/survey/{id опроса}`  
**Ответ:**  
```json  
{
    "id": 1,
    "title": "Опрос",
    "expirationDate": "2022-05-23T13:00:00",
    "description": "Описание к опросу 1",
    "questionList": [
        {
            "id": 1,
            "text": "Вопрос 1 опроса 1",
            "type": "TEXT"
        },
        {
            "id": 2,
            "text": "Вопрос 2 опроса 1",
            "type": "SINGLE_SELECT"
        },
        {
            "id": 3,
            "text": "Вопрос 3 опроса 1",
            "type": "MULTI_SELECT"
        }
    ]
}
```  
### Переименование опроса  (Администратор)  - `POST /api/survey/{id опроса}`
**Запрос:**  
```json  
{
  "title":"Новый заголовок опроса"
}
```  
### Удаление опроса  (Администратор)  - `DELETE /api/survey/{id опроса}`  
### Добавить вопрос к опросу (Администратор) - `PUT /api/survey/question/{id опроса}`  
**Запрос:**  
```json  
{
    "text":"Вопрос",
    "type":"TEXT"
}
```  
### Удаление вопроса в опросе (Администратор) - `DELETE /api/survey/question/{id опроса}`
**Запрос:**  
```json  
{
    "text":"Измененный текст вопроса",
    "type":"SINGLE_SELECT"
}
```  
### Обновление вопроса в опросе (Администратор) - `POST /api/survey/question/{id вопроса}`  
**Запрос:**  
```json  
{
    "text":"Измененный текст вопроса",
    "type":"SINGLE_SELECT"
}
```  
### Прохождение опроса - `POST api/survey/pass/{id опроса}`  
#### Прохождение опроса публично
**Запрос:**  
```json  
{
    "userId":"1",
    "flag":"",
    "answers":{
        "1":"Ответ 1",
        "2":"Ответ 2",
        "3":"Ответ 3"
    }
}
```  
#### Прохождение опроса анонимно
```json  
{
    "userId":"1",
    "flag":"anonymously",
    "answers":{
        "1":"Ответ 1",
        "2":"Ответ 2",
        "3":"Ответ 3"
    }
}
```  
### Получение детализации по пройденным пользователем опросам - `GET api/survey/details/{Уникальный id пользователя}`  
**Ответ:** 
```json  
[
    {
        "surveyName": "Новый заголовок опроса",
        "description": "Описание к опросу 1",
        "endDate": "2022-05-23T13:00:00",
        "questions": [
            {
                "text": "Вопрос 1 опроса 1",
                "type": "TEXT",
                "answer": "Ответ 1"
            },
            {
                "text": "Вопрос 2 опроса 1",
                "type": "SINGLE_SELECT",
                "answer": "Ответ 2"
            },
            {
                "text": "Вопрос 3 опроса 1",
                "type": "MULTI_SELECT",
                "answer": "Ответ 3"
            }
        ]
    }
]
```  



